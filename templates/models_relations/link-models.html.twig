{% extends '@EasyAdmin/page/content.html.twig' %}

{% block content_title %}Link Model to a Model Series{% endblock %}

{% block page_actions %}
    <a id="btnSave" class="btn btn-primary" href="#">Save</a>
{% endblock %}

{% block main %}
    <div>
        Selected Model is: <br>
        <b>Manufacturer:</b> {{ manufacturer }}<br>
        <b>ID:</b> {{ modelId }} <br>
        <b>Name:</b> {{ modelName }} <br>
    </div>
    <br><br>
    Choose the new Parent for the selected Model: <br><br>

    <table class="table datagrid {{ entities is empty ? 'datagrid-empty' }}">
        <thead>
        <tr>
            <td>Select</td>
            <td>Id</td>
            <td>Name</td>
        </tr>
        </thead>
        <tbody>
        {% for entity in entities %}
            <tr>
                <td class="batch-actions-selector" style="width: 100px;">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input form-batch-checkbox" value="{{ entity.id }}">
                    </div>
                </td>
                <td>{{ entity.id }}</td>
                <td>{{ entity.name }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <br>
    <span id="showError" style="color: red"></span>

    <script src="{{ asset('/assets/js/jquery-3.6.3.min.js') }}"></script>
    <script type="application/javascript">
        $(document).ready(function() {

            $('#btnSave').click(function() {
                let spanError = $('#showError');
                spanError.hide();
                let length = $('.form-check-input:checkbox:checked').length;
                if (length < 1) {
                    //alert something
                    console.log('smaller than 1');
                } else if (length > 1) {
                    //alert something
                    console.log('greater than 1');
                } else if ( length === 1) {
                    console.log('equals to 1');

                    let parentId = $('.form-check-input:checkbox:checked')[0].value;
                    let url = "{{ path('app_models_set_relation', {'parentId': 'parentId', 'childId': modelId}) }}";
                    url = url.replace("parentId", parentId);
                    console.log(url);
                    $.ajax({
                        method: "POST",
                        url: url
                    }).done(function() {
                        console.log('success');
                        //redirect to models relations page
                    }).fail(function(response) {
                        spanError.text(response.responseJSON.msg);
                        spanError.show();
                    }).always(function(response) {
                        console.log(response);
                    });
                }
            });
        });
    </script>
{% endblock %}